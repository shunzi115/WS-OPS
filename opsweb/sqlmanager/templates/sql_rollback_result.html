{% extends "public/layout.html" %}

{% block breadcrumb %}
数据库管理 / <strong class="active">SQL回滚结果</strong>
{% endblock %}

{% block body %} 

<div class="col-sm-12">
    <h2 class="text-center">SQL 回滚结果详情</h2>
    </br>
    <table class="table table-striped table-bordered table-hover " id="MyTable">
        <thead>
            <tr>
                <th class="text-center">原SQL序号</th>
                <th class="text-center col-sm-5">原SQL语句</th>
                <th class="text-center">执行影响行数</th>
                <th class="text-center col-sm-4">回滚语句</th>
                <th class="text-center">回滚影响行数</th>
                <th class="text-center">执行花费时间(s)</th>
                <th class="text-center">回滚执行人(s)</th>
                <th class="text-center">错误信息</th>
            </tr>
        </thead>
        <tbody>
            {% for srr in sql_rollback_result_list %}
            <tr class="gradeX">
                <td class="text-center" style="vertical-align: middle">{{ srr.id }}</td>
                <td style="vertical-align: middle">{{ srr.sql }}</td>
                <td class="text-center" style="vertical-align: middle">{{ srr.affected_rows }}</td>
                <td style="vertical-align: middle">{{ srr.sqlrollbackmodel.sql_rollback }}</td>
                <td class="text-center" style="vertical-align: middle">{{ srr.sqlrollbackmodel.rollback_affected_rows }}</td>
                <td class="text-center" style="vertical-align: middle">{{ srr.sqlrollbackmodel.rollback_execute_time }}</td>
                <td class="text-center" style="vertical-align: middle">{{ srr.sqlrollbackmodel.rollback_exec_user.userextend.cn_name }}</td>
                {% if srr.sqlrollbackmodel.rollback_errmsg != 'None'  %}
                    <td class="text-center" style="vertical-align: middle;color: red">{{ srr.sqlrollbackmodel.rollback_errmsg }}</td>
                {% else %}
                    <td class="text-center" style="vertical-align: middle"></td>
                {% endif %}
            </tr>
            {% endfor %}
        </tbody>
    </table>

</div>

{% endblock %}

{% block js %}
<script>
datatable_list()

function datatable_list(){
  $("#MyTable").dataTable({
      "autoWidth":true,
      "ordering": false,
      "bDestroy":true,
      "order": [[ 0, "desc" ]],
      "bStateSave": true,
      "sPaginationType": "full_numbers",
      "language":{
            "lengthMenu":"每页 _MENU_ 条记录",
            "zeroRecords":"没有找到记录",
            "sInfo": "第 _PAGE_ 页 ( 总共 _PAGES_ 页 ),显示第 _START_ 至 _END_ 项(总共 _TOTAL_ 项)",
            "infoEmpty": "无记录",
            "infoFiltered": "(从 _MAX_ 条记录过滤)",
            "sSearch": "搜索:",
            "oPaginate": {
                    "sFirst": "首页",
                    "sPrevious": "上一页",
                    "sNext": "下一页",
                    "sLast": "末页"
            }
      }
  })
};
</script>

{% endblock %}
