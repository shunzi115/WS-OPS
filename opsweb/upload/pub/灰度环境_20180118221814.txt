关于 预发布 环境 方案初步计划

方案一：新浪微博的 ABTestingGateway  参考：http://www.oschina.net/p/abtestinggateway?fromerr=nCrMrH1y
 通过 nginx lua 根据 客户端的 IP 和 UID 引流到相应的 upstream；但是对于后端需要预发布进行测试的，需要手动去 dubbo 上调整 相关服务的 权重，以确保能调度到指定的后端；
 
 所以没去深入了解


方案二：自定义 “独立” 一套环境
 阿里云 上申请 slb + ecs ；
 ecs 上部署相应 的 mop trade user 等 tomcat，php，nodejs 模块，还有 zookeeper
 基础服务 如 oss，rds，ocs，MQ 使用线上的 （待跟 君禄沟通，是否会影响线上）
 
 
 这样，就可以直接用线上的 app 进行测试了，无需再为 预发布环境 重新打 app 包
 
 测试：
     (1)内部测试(备案的问题)
	    办公室客户端通过特定的 wifi 连接，分配 内网 DNS 或 新建 的 DNS，内网DNS 上要配置 “跟模块有关的 域名 均 解析到 SLB 的地址”
		如:
    		gw.watsons.com.cn  SLB地址
            h5.watsons.com.cn  SLB地址
			ws-admin.watsons.com.cn  SLB地址
			
		而：
		   image.watsons.com.cn
		   asset.watsons.com.cn
		   
		   就无需添加进内网 DNS 里
		   
		   用 nginx 做反向代理 ，从 内网代理到 线上
		   
		   
     (2)外部测试
	    将 新的 mop 地址 加入到 线上的 SLB 上，并且 通过调整权重的方式 引流部分 外部的客户端（需要确定 slb 是否可以基于源 IP 将请求调度到同一后端  mop）
  
  
  方案三：nginx 做引流转发，到指定的 mop ，该指定 mop 的 zookeeper 是独立的。